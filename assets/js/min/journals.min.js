!function(){"use strict";const e={initEffect(){$(".joe_loading").remove(),$(".joe_journals__list").removeClass("hidden"),ThemeConfig.enable_journal_effect&&new WOW({boxClass:"wow",animateClass:ThemeConfig.journal_list_effect_class||"fadeIn",offset:0,mobile:!0,live:!0}).init()},formatTime(){$(".joe_journal-posttime").each((function(){const e=$(this);e.html(Utils.timeAgo(e.text()))}))},initLike(){if(!ThemeConfig.enable_like_journal)return;const e=$(".joe_journal__item");e.length&&e.each((function(e,n){const o=$(this),t=o.attr("data-cid"),a=+(o.attr("data-clikes")||0);let i=localStorage.getItem(encryption("agree-journal"))?JSON.parse(decrypt(localStorage.getItem(encryption("agree-journal")))):[],l=i.includes(t);const r=o.find(".journal-like"),c=o.find(".journal-unlike"),s=o.find(".journal-likes-num");l?(r.hide(),c.show()):(r.show(),c.hide()),s.html(a),r.on("click",(function(e){e.stopPropagation();let n=!1;n||(n=!0,i=localStorage.getItem(encryption("agree-journal"))?JSON.parse(decrypt(localStorage.getItem(encryption("agree-journal")))):[],l=i.includes(t),$.ajax({url:"/apis/api.halo.run/v1alpha1/trackers/upvote",type:"post",contentType:"application/json; charset=utf-8",data:JSON.stringify({group:"moment.halo.run",plural:"moments",name:t})}).then((e=>{let n=a;if(l){n--;const e=i.findIndex((e=>e===t));i.splice(e,1),r.show(),c.hide()}else n++,i.push(t),r.hide(),c.show();const o=encryption("agree-journal"),u=encryption(JSON.stringify(i));localStorage.setItem(o,u),s.html(n)})).catch((e=>{n=!1})))}))}))},initComment(){!ThemeConfig.enable_clean_mode&&ThemeConfig.enable_comment_journal&&$(".journal_comment_expander,.journal-comment").on("click",(function(e){e.stopPropagation();const n=$(this).parents(".footer-wrap");console.log("ping"),n.toggleClass("open"),n.find(".journal_comment_expander_txt").html((n.hasClass("open")?"收起":"查看")+"评论")}))},initExpander(){$(".journal_content_expander i").on("click",(function(e){e.stopPropagation(),$(this).parents(".joe_journal_body").toggleClass("open")}))},foldBlock(){$(".joe_journal_body .content-wrp").each((function(){const e=$(this);e[0].getBoundingClientRect().height>=ThemeConfig.journal_block_height&&e.siblings(".journal_content_expander").show()}))}};!function(){const n=["foldBlock"];document.addEventListener("DOMContentLoaded",(function(){Object.keys(e).forEach((o=>!n.includes(o)&&e[o]()))})),window.addEventListener("load",(function(){e.foldBlock()}))}()}();
